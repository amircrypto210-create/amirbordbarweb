<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆÙ‚Ø¹ÛŒØª Ùˆ ØªØ§Ø±ÛŒØ®Ú†Ù‡</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            direction: rtl;
            padding: 20px;
            background-color: #f0f8ff;
            max-width: 1200px;
            margin: 0 auto;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }
        .current-location {
            flex: 1;
            min-width: 300px;
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .history-list {
            flex: 1;
            min-width: 300px;
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-height: 600px;
            overflow-y: auto;
        }
        .coordinates {
            font-family: monospace;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: right;
            border: 1px solid #dee2e6;
        }
        .map-link {
            display: inline-block;
            margin: 10px 5px;
            padding: 10px 20px;
            background-color: #2196F3;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: background-color 0.3s;
        }
        .map-link:hover {
            background-color: #0b7dda;
        }
        .location-item {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-right: 4px solid #4CAF50;
            text-align: right;
            transition: transform 0.2s;
        }
        .location-item:hover {
            transform: translateX(-5px);
            background-color: #f0f7ff;
        }
        .location-item .time {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            display: block;
        }
        .location-item .coords {
            font-family: monospace;
            background-color: #e9ecef;
            padding: 5px 10px;
            border-radius: 4px;
            margin: 5px 0;
            font-size: 14px;
        }
        .action-buttons {
            margin: 20px 0;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .btn-primary {
            background-color: #4CAF50;
            color: white;
        }
        .btn-secondary {
            background-color: #ff9800;
            color: white;
        }
        .btn-danger {
            background-color: #f44336;
            color: white;
        }
        h3 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
            display: inline-block;
        }
        .empty-history {
            color: #999;
            padding: 40px;
            font-style: italic;
        }
        #map {
            height: 300px;
            width: 100%;
            border-radius: 10px;
            margin: 15px 0;
            border: 1px solid #ddd;
        }
    </style>
    <!-- OpenStreetMap Ø¨Ø§ Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <h1>ğŸ“ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§ Ùˆ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§</h1>
    
    <div class="container">
        <!-- Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ -->
        <div class="current-location">
            <h3>Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ</h3>
            
            <div class="coordinates">
                <p><strong>Ø¹Ø±Ø¶ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ:</strong> <span id="lat">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</span></p>
                <p><strong>Ø·ÙˆÙ„ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ:</strong> <span id="lng">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</span></p>
                <p><strong>Ø¯Ù‚Øª:</strong> <span id="acc">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</span> Ù…ØªØ±</p>
            </div>
            
            <div id="map"></div>
            
            <div class="action-buttons">
                <a id="osmLink" class="map-link" target="_blank">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± Ù†Ù‚Ø´Ù‡</a>
                <button id="copyBtn" class="btn btn-primary">Ú©Ù¾ÛŒ Ù…Ø®ØªØµØ§Øª</button>
                <a href="index.html" class="btn btn-secondary">Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¬Ø¯ÛŒØ¯</a>
            </div>
        </div>
        
        <!-- ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ -->
        <div class="history-list">
            <h3>ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡</h3>
            <p style="color: #666; font-size: 14px;">(Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ÛŒ Ù„ÛŒØ³Øª)</p>
            
            <div id="historyContainer">
                <!-- Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ ØªØ§Ø±ÛŒØ®ÛŒ Ø§ÛŒÙ†Ø¬Ø§ Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
            </div>
            
            <div class="action-buttons">
                <button onclick="clearHistory()" class="btn btn-danger">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡</button>
                <button onclick="refreshHistory()" class="btn btn-secondary">Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù„ÛŒØ³Øª</button>
            </div>
        </div>
    </div>

    <script>
        // Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ
        const lat = localStorage.getItem("userLatitude");
        const lng = localStorage.getItem("userLongitude");
        const acc = localStorage.getItem("userAccuracy");
        
        // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ
        document.getElementById("lat").textContent = lat || "Ù†Ø§Ù…Ø´Ø®Øµ";
        document.getElementById("lng").textContent = lng || "Ù†Ø§Ù…Ø´Ø®Øµ";
        document.getElementById("acc").textContent = acc || "Ù†Ø§Ù…Ø´Ø®Øµ";
        
        // Ø¯Ø±ÛŒØ§ÙØª ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§
        function getLocationHistory() {
            const history = localStorage.getItem("locationHistory");
            return history ? JSON.parse(history) : [];
        }
        
        // Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§
        function displayHistory() {
            const history = getLocationHistory();
            const container = document.getElementById("historyContainer");
            
            if (history.length === 0) {
                container.innerHTML = '<div class="empty-history">Ù‡Ù†ÙˆØ² Ù…ÙˆÙ‚Ø¹ÛŒØªÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>';
                return;
            }
            
            let html = '';
            history.forEach((location, index) => {
                html += `
                    <div class="location-item">
                        <strong>Ù…ÙˆÙ‚Ø¹ÛŒØª ${index + 1}</strong>
                        <div class="time">ğŸ“… ${location.timestamp}</div>
                        <div class="coords">
                            Ø¹Ø±Ø¶: ${location.latitude.toFixed(6)}<br>
                            Ø·ÙˆÙ„: ${location.longitude.toFixed(6)}<br>
                            Ø¯Ù‚Øª: ${location.accuracy ? location.accuracy.toFixed(2) + ' Ù…ØªØ±' : 'Ù†Ø§Ù…Ø´Ø®Øµ'}
                        </div>
                        <div style="margin-top: 10px;">
                            <a href="https://www.openstreetmap.org/?mlat=${location.latitude}&mlon=${location.longitude}#map=16/${location.latitude}/${location.longitude}" 
                               target="_blank" style="font-size: 12px; color: #2196F3;">
                               Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± Ù†Ù‚Ø´Ù‡
                            </a>
                            <button onclick="copyCoords('${location.latitude}', '${location.longitude}')" 
                                    style="font-size: 12px; margin-right: 10px; padding: 3px 8px; border: none; background: #e0e0e0; border-radius: 4px; cursor: pointer;">
                                    Ú©Ù¾ÛŒ
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªØ§Ø±ÛŒØ®Ú†Ù‡
        function clearHistory() {
            if (confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ØªÙ…Ø§Ù… ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯ØŸ")) {
                localStorage.removeItem("locationHistory");
                displayHistory();
                alert("ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù¾Ø§Ú© Ø´Ø¯.");
            }
        }
        
        // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù„ÛŒØ³Øª
        function refreshHistory() {
            displayHistory();
        }
        
        // Ú©Ù¾ÛŒ Ù…Ø®ØªØµØ§Øª
        function copyCoords(lat, lng) {
            const text = `${lat}, ${lng}`;
            navigator.clipboard.writeText(text)
                .then(() => alert("Ù…Ø®ØªØµØ§Øª Ú©Ù¾ÛŒ Ø´Ø¯!"))
                .catch(err => console.error("Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ:", err));
        }
        
        // Ú©Ù¾ÛŒ Ù…Ø®ØªØµØ§Øª Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ
        document.getElementById("copyBtn").addEventListener("click", () => {
            if (lat && lng) {
                copyCoords(lat, lng);
            } else {
                alert("Ù…Ø®ØªØµØ§ØªÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.");
            }
        });
        
        // Ø§ÛŒØ¬Ø§Ø¯ Ù„ÛŒÙ†Ú© OpenStreetMap
        if (lat && lng) {
            document.getElementById("osmLink").href = 
                `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lng}#map=16/${lat}/${lng}`;
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù‚Ø´Ù‡ Leaflet
            const map = L.map('map').setView([lat, lng], 15);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);
            
            L.marker([lat, lng]).addTo(map)
                .bindPopup("Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ø´Ù…Ø§")
                .openPopup();
        } else {
            document.getElementById("map").innerHTML = 
                '<div style="padding: 50px; color: #666;">Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>';
        }
        
        // Ù‡Ù†Ú¯Ø§Ù… Ù„ÙˆØ¯ ØµÙØ­Ù‡ØŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
        window.onload = function() {
            displayHistory();
        };
    </script>
</body>
</html>
