<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆÙ‚Ø¹ÛŒØª</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            direction: rtl;
            padding: 50px;
            background-color: #f0f8ff;
        }
        .location-info {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px auto;
            max-width: 600px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .map-link {
            display: inline-block;
            margin: 10px;
            padding: 12px 25px;
            background-color: #2196F3;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: background-color 0.3s;
        }
        .map-link:hover {
            background-color: #0b7dda;
        }
        .coordinates {
            font-family: monospace;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: right;
            border: 1px solid #dee2e6;
        }
        #map {
            height: 400px;
            width: 100%;
            max-width: 600px;
            margin: 25px auto;
            border-radius: 10px;
            border: 2px solid #ddd;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .action-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .btn-secondary {
            background-color: #6c757d;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        .btn-success {
            background-color: #28a745;
        }
        .btn-success:hover {
            background-color: #218838;
        }
        .accuracy-info {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }
    </style>
    <!-- Leaflet CSS & JS Ø¨Ø±Ø§ÛŒ Ù†Ù‚Ø´Ù‡ ØªØ¹Ø§Ù…Ù„ÛŒ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
</head>
<body>
    <h1>Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ ğŸŒ</h1>
    
    <div class="location-info">
        <h3>Ù…Ø®ØªØµØ§Øª Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ:</h3>
        <div class="coordinates">
            <p><strong>Ø¹Ø±Ø¶ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ (Latitude):</strong> <span id="lat">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</span></p>
            <p><strong>Ø·ÙˆÙ„ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ (Longitude):</strong> <span id="lng">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</span></p>
            <p><strong>Ø¯Ù‚Øª:</strong> <span id="acc">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</span> Ù…ØªØ±</p>
            <p class="accuracy-info">(Ø¹Ø¯Ø¯ Ú©Ù…ØªØ± = Ø¯Ù‚Øª Ø¨ÛŒØ´ØªØ±)</p>
        </div>
        
        <h3>Ù†Ù‚Ø´Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª:</h3>
        <div id="map">
            <!-- Ù†Ù‚Ø´Ù‡ Leaflet Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
        </div>
        
        <div class="action-buttons">
            <a id="osmLink" class="map-link" target="_blank">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± OpenStreetMap</a>
            <a id="googleMapLink" class="map-link btn-secondary" target="_blank">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± Google Maps</a>
            <button id="copyBtn" class="map-link btn-success">Ú©Ù¾ÛŒ Ù…Ø®ØªØµØ§Øª</button>
            <a class="map-link" href="index.html" style="background-color: #4CAF50;">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</a>
        </div>
        
        <div style="margin-top: 20px; font-size: 12px; color: #777;">
            Ù†Ù‚Ø´Ù‡ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² <a href="https://leafletjs.com/" target="_blank">Leaflet</a> Ùˆ 
            <a href="https://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
        </div>
    </div>

    <script>
        // Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡
        const lat = localStorage.getItem("userLatitude");
        const lng = localStorage.getItem("userLongitude");
        const acc = localStorage.getItem("userAccuracy");
        
        // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
        document.getElementById("lat").textContent = lat || "Ù†Ø§Ù…Ø´Ø®Øµ";
        document.getElementById("lng").textContent = lng || "Ù†Ø§Ù…Ø´Ø®Øµ";
        document.getElementById("acc").textContent = acc || "Ù†Ø§Ù…Ø´Ø®Øµ";
        
        // Ø§ÛŒØ¬Ø§Ø¯ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§
        if(lat && lng) {
            const latNum = parseFloat(lat);
            const lngNum = parseFloat(lng);
            
            // Ù„ÛŒÙ†Ú© OpenStreetMap
            const osmLink = document.getElementById("osmLink");
            osmLink.href = `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lng}#map=16/${lat}/${lng}`;
            
            // Ù„ÛŒÙ†Ú© Google Maps
            const googleMapLink = document.getElementById("googleMapLink");
            googleMapLink.href = `https://www.google.com/maps?q=${lat},${lng}`;
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù‚Ø´Ù‡ Leaflet
            initLeafletMap(latNum, lngNum, acc);
            
            // Ø¯Ú©Ù…Ù‡ Ú©Ù¾ÛŒ Ù…Ø®ØªØµØ§Øª
            document.getElementById("copyBtn").addEventListener("click", function() {
                const coordinates = `${lat}, ${lng}`;
                navigator.clipboard.writeText(coordinates)
                    .then(() => {
                        const originalText = this.textContent;
                        this.textContent = "Ú©Ù¾ÛŒ Ø´Ø¯!";
                        this.style.backgroundColor = "#28a745";
                        setTimeout(() => {
                            this.textContent = originalText;
                        }, 2000);
                    })
                    .catch(err => {
                        console.error("Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù†: ", err);
                        alert("Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù…Ø®ØªØµØ§Øª");
                    });
            });
        } else {
            document.getElementById("map").innerHTML = 
                '<div style="padding: 100px; color: #666;">Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ø¨Ø§Ø²Ú¯Ø±Ø¯ÛŒØ¯.</div>';
        }
        
        // ØªØ§Ø¨Ø¹ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù‚Ø´Ù‡ Leaflet
        function initLeafletMap(latitude, longitude, accuracy) {
            // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù‚Ø´Ù‡
            const map = L.map('map').setView([latitude, longitude], 15);
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù„Ø§ÛŒÙ‡ Ù†Ù‚Ø´Ù‡ OpenStreetMap
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 19
            }).addTo(map);
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø§Ø±Ú©Ø±
            const marker = L.marker([latitude, longitude]).addTo(map)
                .bindPopup(`Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§<br>Ø¹Ø±Ø¶: ${latitude.toFixed(6)}<br>Ø·ÙˆÙ„: ${longitude.toFixed(6)}`)
                .openPopup();
            
            // Ø§Ú¯Ø± Ø¯Ù‚Øª Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ø´Ø¯ØŒ Ø¯Ø§ÛŒØ±Ù‡ Ø¯Ù‚Øª Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
            if (accuracy) {
                const accuracyCircle = L.circle([latitude, longitude], {
                    color: 'blue',
                    fillColor: '#03a9f4',
                    fillOpacity: 0.1,
                    radius: parseFloat(accuracy)
                }).addTo(map);
            }
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ù†Ù‚Ø´Ù‡
            L.control.scale().addTo(map);
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ
            L.control.locate({
                position: 'topright',
                drawCircle: true,
                follow: false,
                setView: true,
                keepCurrentZoomLevel: false,
                markerStyle: {
                    weight: 1,
                    opacity: 0.8,
                    fillOpacity: 0.8
                },
                circleStyle: {
                    weight: 1,
                    clickable: false
                },
                icon: 'fa fa-map-marker',
                metric: true,
                strings: {
                    title: "Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ù†",
                    popup: "Ø´Ù…Ø§ Ø¯Ø± Ø§ÛŒÙ† Ø­Ø¯ÙˆØ¯ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±ÛŒØ¯"
                },
                locateOptions: {
                    maxZoom: 16,
                    watch: false,
                    enableHighAccuracy: true
                }
            }).addTo(map);
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ù†ØªØ±Ù„ Ø¬Ø³ØªØ¬Ùˆ
            const searchControl = new L.Control.Search({
                position: 'topleft',
                layer: marker,
                initial: false,
                zoom: 17,
                marker: false,
                textPlaceholder: 'Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ú©Ø§Ù†...'
            });
            map.addControl(searchControl);
        }
        
        // ØªØ§Ø¨Ø¹ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø³Ø§Ø¯Ù‡â€ŒØªØ± (Ø§Ú¯Ø± Ù†Ø®ÙˆØ§Ù‡ÛŒØ¯ Ø§Ø² Leaflet Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯)
        function showSimpleOSMMap() {
            if(lat && lng) {
                const mapElement = document.getElementById("map");
                mapElement.innerHTML = `
                    <iframe 
                        width="100%" 
                        height="400" 
                        frameborder="0" 
                        scrolling="no" 
                        marginheight="0" 
                        marginwidth="0" 
                        src="https://www.openstreetmap.org/export/embed.html?bbox=${lng-0.01},${lat-0.01},${lng+0.01},${lat+0.01}&layer=mapnik&marker=${lat},${lng}"
                        style="border: none; border-radius: 10px;">
                    </iframe>
                    <br/>
                    <small>
                        <a href="https://www.openstreetmap.org/?mlat=${lat}&mlon=${lng}#map=16/${lat}/${lng}" target="_blank">
                            Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù†Ù‚Ø´Ù‡ Ø¨Ø²Ø±Ú¯ØªØ±
                        </a>
                    </small>`;
            }
        }
        
        // Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù†Ø³Ø®Ù‡ Ø³Ø§Ø¯Ù‡â€ŒØªØ±ØŒ Ø®Ø· Ø²ÛŒØ± Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯:
        // showSimpleOSMMap();
    </script>
</body>
</html>
